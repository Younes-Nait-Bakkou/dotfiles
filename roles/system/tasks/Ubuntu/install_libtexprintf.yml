---

- name: Check if libtexprintf library already exists
  ansible.builtin.stat:
    path: /usr/local/lib/libtexprintf.a
  register: libtexprintf_stat

- name: Install build dependencies for libtexprintf
  ansible.builtin.apt:
    name:
      - build-essential
      - autoconf
      - automake
      - libtool
      - pkg-config
      - git
    state: present
    update_cache: true
  become: true
  when: not libtexprintf_stat.stat.exists

- name: Clone libtexprintf repository
  ansible.builtin.git:
    repo: https://github.com/bartp5/libtexprintf.git
    dest: /tmp/libtexprintf
    version: main
    force: true
  when: not libtexprintf_stat.stat.exists

- name: Prepare libtexprintf build (autogen.sh)
  ansible.builtin.command: ./autogen.sh
  args:
    chdir: /tmp/libtexprintf
    creates: /tmp/libtexprintf/Makefile
  when: not libtexprintf_stat.stat.exists

- name: Configure libtexprintf
  ansible.builtin.command: ./configure
  args:
    chdir: /tmp/libtexprintf
    creates: /tmp/libtexprintf/config.status
  when: not libtexprintf_stat.stat.exists

- name: Build libtexprintf
  ansible.builtin.command: make
  args:
    chdir: /tmp/libtexprintf
    creates: /tmp/libtexprintf/libtexprintf.a
  when: not libtexprintf_stat.stat.exists

- name: Install libtexprintf
  ansible.builtin.command: make install
  args:
    chdir: /tmp/libtexprintf
    creates: /usr/local/lib/libtexprintf.a
  become: true
  when: not libtexprintf_stat.stat.exists
