---

- name: 'Run Tasks: {{ remote.distribution }}'
  ansible.builtin.include_tasks: '{{ item }}'
  with_first_found:
    - files:
        - '{{ remote.distribution }}.yml'
      skip: true

- name: Check if nvim config exists
  ansible.builtin.stat:
    path: '{{ remote.HOME }}/.config/nvim'
  register: nvim_config_stat

- name: Backup existing config if not a symlink
  when:
    - nvim_config_stat.stat.exists
    - not nvim_config_stat.stat.islnk
  ansible.builtin.command:
    cmd: mv {{ remote.HOME }}/.config/nvim {{ remote.HOME }}/.config/nvim.backup-{{timestamp}}
  args:
    creates: '{{ remote.HOME }}/.config/nvim.backup-{{timestamp}}'

- name: Create symlink to role files directory
  ansible.builtin.file:
    src: '{{ role_path }}/files/nvim'
    dest: '{{ remote.HOME }}/.config/nvim'
    state: link
    force: true
