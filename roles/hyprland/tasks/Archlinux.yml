---

- name: Install Hyprland and Dependencies
  ansible.builtin.package:
    name:
      - hyprland
      - polkit-kde-agent
      - xdg-desktop-portal-hyprland
      - qt5-wayland
      - qt6-wayland
    state: present
  become: true

- name: Apply VMware Environment Fixes
  ansible.builtin.blockinfile:
    path: /etc/environment
    marker: '# {mark} ANSIBLE MANAGED: Hyprland VMware Fixes'
    block: |
      WLR_NO_HARDWARE_CURSORS=1
      WLR_RENDERER_ALLOW_SOFTWARE=1
      LIBGL_ALWAYS_SOFTWARE=1
  become: true

- name: Ensure Hyprland Config Directory Exists
  ansible.builtin.file:
    path: '{{ hyprland_config_dir }}'
    state: directory
    owner: '{{ remote.USER }}'
    group: '{{ remote.USER }}'
    mode: '0755'

- name: Remove existing Hyprland config if it's not a symlink
  ansible.builtin.file:
    path: '{{ hyprland_config_dir }}'
    state: absent
  when: hyprland_config_dir is not link

- name: Symlink Hyprland Config
  ansible.builtin.file:
    src: '{{ hyprland_config_src }}'
    dest: '{{ hyprland_config_dir }}'
    state: link
    force: true
